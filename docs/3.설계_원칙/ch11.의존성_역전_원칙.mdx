---
sidebar_position: 5
---

# 11장 의존성 역전 원칙

💡 **의존성 역전 원칙 (DIP: Dependency Inversion Principle)** 고수준 정책을 구현하는 코드는 _저수준 세부사항을 구현하는 코드에 절대로 의존해서는 안 된다._
대신 *세부사항이 정책에 의존*해야 한다.

---

## 11-1. Intro

- 유연성이 극대화 된 시스템 (의존성 역전 원칙에서 말하는)
  - 소스 코드 의존성이 추상에 의존
  - 구체에는 의존하지 않는 시스템
- 정적 타입 언어 (자바 등)
  - use, import, include 구문은
  - 오직 인터페이스나 추상 클래스 같은 추상적인 선언만을 참조해야 한다는 뜻
  - 구체적인 대상에는 절대로 의존해서는 안 됨
- 동적 타입 언어 (루비, 파이썬)
  - 정적 타입 언어와 동일한 규칙이 적용
  - 소스 코드 의존 관계에서 구체 모듈은 참조해서는 안 됨
  - 구체 모듈이 무엇인지를 정의하기는 다소 어려움
  - 호출할 함수가 구현된 모듈이라면 참조하지 않기가 특히 어려움
- 소프트웨어 시스템은 구체적인 많은 장치에 반드시 의존하기 때문에 규칙으로는 비현실적
  - java에서의 String
    - 구체 클래스
    - 추상 클래스로 만들려는 시도는 현실성이 없음
    - java.lang.String 구체 클래스에 대한 소스 코드 의존성은 벗어나지 못하며, 벗어나서도 안 됨
    - 매우 안정적
    - 클래서가 변경되는 일은 거의 없으며, 있더라도 엄격 통제 대상
- DIP를 논할 때, 운영체제나 플랫폼 같이 안정성이 보장된 환경에 대해서는 무시
- 환경에 대한 의존성은 용납하지만, 변경되지 않는다면 의존할 수 있다는 사실을 이미 알고 있기 때문
- 의존을 피하고자 하는 것
  - 변동성이 큰 구체적인 요소
  - 즉, 자주 변경될 수밖에 없는 모듈들

## 11-2. 안정된 추상화

- 추상 인터페이스에 변경 발생
  - 이를 구체화한 구현체들도 따라서 수정
- 구체적인 구현체에 변경 발생
  - 그 구현체가 구현하는 인터페이스는 대다수의 경우 변경될 필요가 없다.
- 즉, 인터페이스는 구현체보다 변동성이 낮다.
- 설계의 기본
  - 뛰어난 소프트웨어 설계자와 아키텍트는 인터페이스의 변동성을 낮추기 위해 노력
  - 인터페이스를 변경하지 않고도 구현체에 기능을 추가할 수 있는 방법을 찾기 위해 노력
- 즉, 안정된 소프트웨어 아키텍처
  - 변동성이 큰 구현체에 의존하는 일은 지양
  - 안정된 추상 인터페이스를 선호하는 아키텍처
- **실천법**
  1. 변동성이 큰 구체 클래스를 참조하지 말라
  2. 변동성이 큰 구체 클래스로부터 파생하지 말라
  3. 구체 함수를 오버라이드 하지 말라
  4. 구체적이며 변동성이 크다면 절대로 그 이름을 언급하지 말라

## 11-3. 팩토리

- 앞서 언급한 규칙들을 준수하기 위해서 변동성이 큰 구체적인 객체는 주의해서 생성
- 모든 언어에서 객체를 생성하려면 해당 객체를 구체적으로 정의한 코드에 대해 소스 코드 의존성이 발생
- 추상 팩토리가 사용되는 때
  - 객체 지향 언어에서 바람직하지 못한 의존성을 처리할 때
- 추상 팩토리를 사용한 구조
  - 아키텍처의 경계를 만들어 구체적인 것들로 부터 추상적인 것들을 분리
  - 소스 코드 의존성은 경계와 교차할 때 모두 한 방향
  - 즉, 추상적인 쪽으로 향함
  - 경계는 시스템을 두 가지 컴포넌트로 분리
    1. 추상 컴포넌트
    - 애플리케이션의 모든 고수준 업무 규칙을 포함
    2. 구체 컴포넌트
    - 업무 규칙을 다루기 위해 필요한 모든 세부사항을 포함

## 11-4. 구체 컴포넌트

- 구체적인 의존성이 하나 존재하며 DIP에 위배 (일반적)
- DIP를 위배를 모두 없앨 수는 없음
- DIP를 위배하는 클래스들
  - 적은 수의 구체 컴포넌트 내부로 모음
  - 이를 통해 시스템의 나머지 부분과 분리
- 대다수의 시스템은 구체 컴포넌트를 최소한 하는느 포함 (Main 컴포넌트)
  - main 함수를 포함하기 때문 (애플리케이션이 처음 구동될 때 운영체제가 호출하는 함수)
  - main 함수가 특정 인스턴스를 생성한 후, 인스턴스를 특정 타입으로 전역 변수에 저장하여,
    다음 애플리케이션은 전역 변수를 통해 특정 인스턴스에 접근

## 11-5. 결론

- DIP는 아키텍처 다이어그램에서 가장 눈에 드러나는 원칙
- 의존성은 곡선을 경계로 더 추상적인 엔티티가 있는 쪽으로 향한다 (의존성 규칙)
